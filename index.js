// Generated by CoffeeScript 1.6.3
var empty, git, join, map, previousCommits, series, _ref;

git = require('gitteh-promisified');

_ref = require('reduced'), join = _ref.join, series = _ref.series, map = _ref.map, empty = _ref.empty;

previousCommits = function(commit) {
  var getCommit, getPreviousCommit;
  getCommit = function(id) {
    return commit.then(function(commit) {
      return commit.repository.commit(id);
    });
  };
  getPreviousCommit = function(commit) {
    var parents;
    if (commit.parents.length > 0) {
      parents = map(commit.parents, getCommit);
      return join(map(parents, previousCommits));
    } else {
      return empty();
    }
  };
  return join(series(getPreviousCommit, commit));
};

module.exports = function(ref) {
  return previousCommits(ref.repository.commit(ref.target));
};
